# trigger: none

# pr:
#   - v3-api

# schedules:
# - cron: "0 2 * * *"
#   displayName: Daily 10PM build
#   # 2am UTC is 10PM eastern time
#   branches:
#     include:
#     - "*"

variables:
  image_root: glotzerlab/ci:2021.01

jobs:
- job: notebooks
  displayName: Execute notebooks
  timeoutInMinutes: 360

  pool:
    name: 'GPU'
    demands: short_jobs

  container:
      image: $(image_root)-cuda11_gcc9_py38
      options: -u 0 --gpus=all --cpus=4 --memory=16g -e CUDA_VISIBLE_DEVICES

  workspace:
    clean: all

  steps:
  - template: templates/build_fresnel.yml
  - template: templates/build_hoomd.yml
  - script: jupyter nbconvert --execute --inplace **/*.ipynb
    displayName: Execute notebooks
    workingDirectory: $(Build.SourcesDirectory)
    env:
      PYTHONPATH: $(Pipeline.Workspace)/hoomd/build:$(Pipeline.Workspace)/fresnel/build

